-- -------------------------------------------------------------
-- 
-- File Name: hdl_prj\OFDM_tx\hdlsrc\OFDM_Tx_Rx_HW\ofdm_tx_src_DataGenerator.vhd
-- Created: 2021-01-08 12:14:22
-- 
-- Generated by MATLAB 9.8 and HDL Coder 3.16
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: ofdm_tx_src_DataGenerator
-- Source Path: OFDM_Tx_Rx_HW/OFDMTx/DataGenerator
-- Hierarchy Level: 1
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY ofdm_tx_src_DataGenerator IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        enb_1_192_0                       :   IN    std_logic;
        modScheme                         :   IN    std_logic_vector(1 DOWNTO 0);  -- ufix2
        dataValid                         :   IN    std_logic;
        preambleValid                     :   IN    std_logic;
        dataReady                         :   IN    std_logic;
        pilotValid                        :   IN    std_logic;
        dataOut_re                        :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
        dataOut_im                        :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
        preambValOut                      :   OUT   std_logic;
        dataValidOut                      :   OUT   std_logic
        );
END ofdm_tx_src_DataGenerator;


ARCHITECTURE rtl OF ofdm_tx_src_DataGenerator IS

  -- Component Declarations
  COMPONENT ofdm_tx_src_SymbolsGen
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_192_0                     :   IN    std_logic;
          modScheme                       :   IN    std_logic_vector(1 DOWNTO 0);  -- ufix2
          valid                           :   IN    std_logic;
          symbsOut_re                     :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          symbsOut_im                     :   OUT   std_logic_vector(15 DOWNTO 0)  -- sfix16_En14
          );
  END COMPONENT;

  COMPONENT ofdm_tx_src_PilotGen
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_192_0                     :   IN    std_logic;
          dataValidIn                     :   IN    std_logic;
          pilotValidIn                    :   IN    std_logic;
          pilotOut_re                     :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          pilotOut_im                     :   OUT   std_logic_vector(15 DOWNTO 0)  -- sfix16_En14
          );
  END COMPONENT;

  COMPONENT ofdm_tx_src_STSFreq
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_192_0                     :   IN    std_logic;
          preamVal                        :   IN    std_logic;
          stsFreq_re                      :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          stsFreq_im                      :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          stsVal                          :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT ofdm_tx_src_LTSfreq
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_192_0                     :   IN    std_logic;
          preambVal                       :   IN    std_logic;
          ltsFreq                         :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          ltsVal                          :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT ofdm_tx_src_Data_Multiplexer
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_192_0                     :   IN    std_logic;
          symbols_re                      :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          symbols_im                      :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          dataready                       :   IN    std_logic;
          pilots_re                       :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          pilots_im                       :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          pval                            :   IN    std_logic;
          sts_re                          :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          sts_im                          :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          stsval                          :   IN    std_logic;
          lts                             :   IN    std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          ltsval                          :   IN    std_logic;
          data_re                         :   OUT   std_logic_vector(15 DOWNTO 0);  -- sfix16_En14
          data_im                         :   OUT   std_logic_vector(15 DOWNTO 0)  -- sfix16_En14
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : ofdm_tx_src_SymbolsGen
    USE ENTITY work.ofdm_tx_src_SymbolsGen(rtl);

  FOR ALL : ofdm_tx_src_PilotGen
    USE ENTITY work.ofdm_tx_src_PilotGen(rtl);

  FOR ALL : ofdm_tx_src_STSFreq
    USE ENTITY work.ofdm_tx_src_STSFreq(rtl);

  FOR ALL : ofdm_tx_src_LTSfreq
    USE ENTITY work.ofdm_tx_src_LTSfreq(rtl);

  FOR ALL : ofdm_tx_src_Data_Multiplexer
    USE ENTITY work.ofdm_tx_src_Data_Multiplexer(rtl);

  -- Signals
  SIGNAL modScheme_unsigned               : unsigned(1 DOWNTO 0);  -- ufix2
  SIGNAL modScheme_1                      : unsigned(1 DOWNTO 0);  -- ufix2
  SIGNAL dataReady_1                      : std_logic;
  SIGNAL SymbolsGen_out1_re               : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL SymbolsGen_out1_im               : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL dataValid_1                      : std_logic;
  SIGNAL pilotValid_1                     : std_logic;
  SIGNAL PilotGen_out1_re                 : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL PilotGen_out1_im                 : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL preambleValid_1                  : std_logic;
  SIGNAL STSFreq_out1_re                  : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL STSFreq_out1_im                  : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL STSFreq_out2                     : std_logic;
  SIGNAL LTSfreq_out1                     : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL LTSfreq_out2                     : std_logic;
  SIGNAL data_re                          : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL data_im                          : std_logic_vector(15 DOWNTO 0);  -- ufix16
  SIGNAL data_re_signed                   : signed(15 DOWNTO 0);  -- sfix16_En14
  SIGNAL data_im_signed                   : signed(15 DOWNTO 0);  -- sfix16_En14
  SIGNAL data_re_1                        : signed(15 DOWNTO 0);  -- sfix16_En14
  SIGNAL data_im_1                        : signed(15 DOWNTO 0);  -- sfix16_En14
  SIGNAL preambleValid_2                  : std_logic;
  SIGNAL dataValid_2                      : std_logic;

BEGIN
  u_SymbolsGen : ofdm_tx_src_SymbolsGen
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_192_0 => enb_1_192_0,
              modScheme => std_logic_vector(modScheme_1),  -- ufix2
              valid => dataReady_1,
              symbsOut_re => SymbolsGen_out1_re,  -- sfix16_En14
              symbsOut_im => SymbolsGen_out1_im  -- sfix16_En14
              );

  u_PilotGen : ofdm_tx_src_PilotGen
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_192_0 => enb_1_192_0,
              dataValidIn => dataValid_1,
              pilotValidIn => pilotValid_1,
              pilotOut_re => PilotGen_out1_re,  -- sfix16_En14
              pilotOut_im => PilotGen_out1_im  -- sfix16_En14
              );

  u_STSFreq : ofdm_tx_src_STSFreq
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_192_0 => enb_1_192_0,
              preamVal => preambleValid_1,
              stsFreq_re => STSFreq_out1_re,  -- sfix16_En14
              stsFreq_im => STSFreq_out1_im,  -- sfix16_En14
              stsVal => STSFreq_out2
              );

  u_LTSfreq : ofdm_tx_src_LTSfreq
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_192_0 => enb_1_192_0,
              preambVal => preambleValid_1,
              ltsFreq => LTSfreq_out1,  -- sfix16_En14
              ltsVal => LTSfreq_out2
              );

  u_Data_Multiplexer : ofdm_tx_src_Data_Multiplexer
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_192_0 => enb_1_192_0,
              symbols_re => SymbolsGen_out1_re,  -- sfix16_En14
              symbols_im => SymbolsGen_out1_im,  -- sfix16_En14
              dataready => dataReady_1,
              pilots_re => PilotGen_out1_re,  -- sfix16_En14
              pilots_im => PilotGen_out1_im,  -- sfix16_En14
              pval => pilotValid_1,
              sts_re => STSFreq_out1_re,  -- sfix16_En14
              sts_im => STSFreq_out1_im,  -- sfix16_En14
              stsval => STSFreq_out2,
              lts => LTSfreq_out1,  -- sfix16_En14
              ltsval => LTSfreq_out2,
              data_re => data_re,  -- sfix16_En14
              data_im => data_im  -- sfix16_En14
              );

  modScheme_unsigned <= unsigned(modScheme);

  in_0_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      modScheme_1 <= to_unsigned(16#0#, 2);
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        modScheme_1 <= modScheme_unsigned;
      END IF;
    END IF;
  END PROCESS in_0_pipe_process;


  in_3_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      dataReady_1 <= '0';
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        dataReady_1 <= dataReady;
      END IF;
    END IF;
  END PROCESS in_3_pipe_process;


  in_1_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      dataValid_1 <= '0';
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        dataValid_1 <= dataValid;
      END IF;
    END IF;
  END PROCESS in_1_pipe_process;


  in_4_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      pilotValid_1 <= '0';
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        pilotValid_1 <= pilotValid;
      END IF;
    END IF;
  END PROCESS in_4_pipe_process;


  in_2_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      preambleValid_1 <= '0';
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        preambleValid_1 <= preambleValid;
      END IF;
    END IF;
  END PROCESS in_2_pipe_process;


  data_re_signed <= signed(data_re);

  data_im_signed <= signed(data_im);

  out_0_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      data_re_1 <= to_signed(16#0000#, 16);
      data_im_1 <= to_signed(16#0000#, 16);
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        data_re_1 <= data_re_signed;
        data_im_1 <= data_im_signed;
      END IF;
    END IF;
  END PROCESS out_0_pipe_process;


  dataOut_re <= std_logic_vector(data_re_1);

  dataOut_im <= std_logic_vector(data_im_1);

  out_1_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      preambleValid_2 <= '0';
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        preambleValid_2 <= preambleValid_1;
      END IF;
    END IF;
  END PROCESS out_1_pipe_process;


  out_2_pipe_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      dataValid_2 <= '0';
    ELSIF clk'EVENT AND clk = '1' THEN
      IF enb_1_192_0 = '1' THEN
        dataValid_2 <= dataValid_1;
      END IF;
    END IF;
  END PROCESS out_2_pipe_process;


  preambValOut <= preambleValid_2;

  dataValidOut <= dataValid_2;

END rtl;

